<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP32 Robot Kontrol√º</title>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            background: linear-gradient(to bottom right, #1a202c, #2d3748);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
            color: #fff;
        }
        .container {
            background-color: #2d3748;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 8px 10px -6px rgba(0, 0, 0, 0.5);
            width: 100%;
            max-width: 28rem;
            border: 1px solid #4a5568;
        }
        h1 {
            font-size: 1.875rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 1.5rem;
            color: #fff;
        }
        .status-display {
            margin-bottom: 2rem;
            padding: 1rem;
            background-color: #4a5568;
            border-radius: 0.5rem;
            text-align: center;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.3);
        }
        .status-display p {
            margin: 0;
            color: #cbd5e0;
            font-size: 1.125rem;
            margin-bottom: 0.5rem;
        }
        .status-display .status-text {
            color: #48bb78;
            font-size: 1.5rem;
            font-weight: 600;
        }
        .message-text {
            color: #90cdf4;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        .control-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
            justify-items: center;
            align-items: center;
        }
        .button {
            background-color: #4299e1;
            color: white;
            font-weight: bold;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -2px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease-in-out;
            transform: scale(1);
            cursor: pointer;
            border: none;
            outline: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            width: 100%; /* Ana kontrol butonlarƒ± i√ßin %100 geni≈ülik */
            height: 100%;
            min-height: 60px;
            -webkit-user-select: none; /* Safari */
            -moz-user-select: none; /* Firefox */
            -ms-user-select: none; /* IE10+ */
            user-select: none; /* Standard syntax */
        }
        .button:hover {
            background-color: #3182ce;
            transform: scale(1.05);
        }
        .button:active {
            transform: scale(0.98);
        }
        .button:focus {
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.5), 0 0 0 6px rgba(66, 153, 225, 0.25);
        }
        .button[disabled] {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .button svg {
            height: 1.5rem;
            width: 1.5rem;
            margin-bottom: 0.25rem;
            stroke: currentColor;
            stroke-width: 2;
        }
        .button.red {
            background-color: #e53e3e;
        }
        .button.red:hover {
            background-color: #c53030;
        }
        .button.purple {
            background-color: #805ad5;
        }
        .button.purple:hover {
            background-color: #6b46c1;
        }
        .button.green {
            background-color: #38a169;
        }
        .button.green:hover {
            background-color: #2f855a;
        }
        .button.yellow {
            background-color: #d69e2e;
        }
        .button.yellow:hover {
            background-color: #b7791f;
        }
        /* Grid Pozisyonlarƒ± */
        .grid-item-top { grid-column: 2 / 3; grid-row: 1 / 2; }
        .grid-item-left { grid-column: 1 / 2; grid-row: 2 / 3; }
        .grid-item-center { grid-column: 2 / 3; grid-row: 2 / 3; }
        .grid-item-right { grid-column: 3 / 4; grid-row: 2 / 3; }
        .grid-item-bottom { grid-column: 2 / 3; grid-row: 3 / 4; }

        .input-area {
            margin-bottom: 2rem;
            padding: 1rem;
            background-color: #4a5568;
            border-radius: 0.5rem;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.3);
            text-align: center; /* ƒ∞√ßindeki butonlarƒ± ortalamak i√ßin */
        }
        .input-area h2 {
            font-size: 1.25rem;
            font-weight: bold;
            color: #fff;
            margin-bottom: 1rem;
        }
        .input-area textarea {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            background-color: #1a202c;
            color: #fff;
            border: 1px solid #4a5568;
            outline: none;
            box-sizing: border-box;
        }
        .input-area textarea:focus {
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.5), 0 0 0 6px rgba(66, 153, 225, 0.25);
        }
        .info-text {
            color: #a0aec0;
            font-size: 0.875rem;
            text-align: center;
            margin-top: 2rem;
        }

        /* Input alanlarƒ± i√ßindeki butonlar i√ßin √∂zel stil */
        .input-area .button {
            width: auto; /* Geni≈üliƒüi i√ßeriƒüe g√∂re ayarla */
            min-height: 40px; /* Minimum y√ºksekliƒüi azalt */
            padding: 0.5rem 1.5rem; /* Dolguyu azalt */
            font-size: 0.875rem; /* Yazƒ± boyutunu k√º√ß√ºlt */
            display: inline-flex; /* ƒ∞√ßeriƒüe g√∂re geni≈ülemesini saƒüla ve ortalanabilir yap */
            margin-top: 0.5rem; /* √úst bo≈üluƒüu koru */
        }
        .input-area .button svg {
            height: 1.25rem; /* ƒ∞kon boyutunu k√º√ß√ºlt */
            width: 1.25rem;
            margin-bottom: 0.125rem; /* ƒ∞kon alt bo≈üluƒüunu azalt */
        }

        /* Slider i√ßin stil */
        .slider-container {
            margin-top: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.5rem;
            background-color: #2d3748;
            border-radius: 0.5rem;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.3);
        }
        .slider-container input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            background: #4a5568;
            outline: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4299e1;
            cursor: pointer;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.5);
        }
        .slider-container input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4299e1;
            cursor: pointer;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.5);
        }
        .slider-container .speed-value {
            font-weight: bold;
            color: #fff;
            min-width: 40px;
            text-align: right;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ESP32 Robot Kontrol√º</h1>

        <div class="status-display">
            <p>Mevcut Durum:</p>
            <p id="robotStatus" class="status-text">Durduruldu</p>
            <p id="apiMessage" class="message-text"></p>
        </div>

        <div class="control-grid">
            <button class="button grid-item-top"
                    onmousedown="startContinuousMove('ƒ∞leri')" ontouchstart="startContinuousMove('ƒ∞leri')"
                    onmouseup="stopContinuousMove()" ontouchend="stopContinuousMove()"
                    id="forwardBtn">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                </svg>
            </button>

            <button class="button purple grid-item-left"
                    onmousedown="startContinuousMove('Sola D√∂n')" ontouchstart="startContinuousMove('Sola D√∂n')"
                    onmouseup="stopContinuousMove()" ontouchend="stopContinuousMove()"
                    id="leftBtn">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M11 15l-3-3m0 0l3-3m-3 3h8M3 12a9 9 0 1118 0M3 12h18" />
                </svg>
            </button>

            <button class="button red grid-item-center" onclick="sendMovementCommand('Durduruldu')" id="stopBtn">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z" />
                </svg>
            </button>

            <button class="button purple grid-item-right"
                    onmousedown="startContinuousMove('Saƒüa D√∂n')" ontouchstart="startContinuousMove('Saƒüa D√∂n')"
                    onmouseup="stopContinuousMove()" ontouchend="stopContinuousMove()"
                    id="rightBtn">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M13 9l3 3m0 0l-3 3m3-3H6m18 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </button>

            <button class="button grid-item-bottom"
                    onmousedown="startContinuousMove('Geri')" ontouchstart="startContinuousMove('Geri')"
                    onmouseup="stopContinuousMove()" ontouchend="stopContinuousMove()"
                    id="backwardBtn">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
                </svg>
            </button>
        </div>

        <div class="input-area">
            <h2>‚öôÔ∏è Motor G√ºc√º</h2>
            <div class="slider-container">
                <input type="range" id="motorSpeedSlider" min="30" max="100" value="100" oninput="updateMotorSpeed(this.value)">
                <span id="motorSpeedValue" class="speed-value">100%</span>
            </div>
        </div>

        <div class="input-area">
            <h2>üí° Farlar</h2>
            <button class="button yellow" onclick="toggleHeadlights()" id="headlightsBtn">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4.228 4.228l.707.707M1.636 18.364l.707-.707M12 21v-1m-6.364-1.636l.707-.707M3 12H2m15.364 4.364l.707.707M12 3a7.5 7.5 0 100 15 7.5 7.5 0 000-15z" />
                </svg>
                Farlarƒ± A√ß / Kapat
            </button>
        </div>

        <div class="input-area">
            <h2>‚ú® Akƒ±llƒ± Yol Planlayƒ±cƒ±</h2>
            <textarea id="pathInput" rows="3" placeholder="√ñrn: ileri 2 saniye, sonra saƒüa d√∂n 1 saniye, sonra dur."></textarea>
            <button class="button green" onclick="generatePathPlan()" id="planBtn">
                Yol Planƒ± Olu≈ütur ve Y√ºr√ºt
            </button>
        </div>

        <div class="input-area">
            <h2>‚ú® Yaratƒ±cƒ± Hareket √ñnerisi</h2>
            <button class="button yellow" onclick="generateCreativeMovement()" id="creativeBtn">
                Yaratƒ±cƒ± Bir Hareket √ñnerisi Al
            </button>
        </div>

        <p class="info-text">
          Bu uygulama, ESP32 tabanlƒ± bir robot i√ßin basit bir kontrol aray√ºz√º demosudur. Ger√ßek robot kontrol√º i√ßin ESP32'de uygun firmware ve aƒü ileti≈üimi (Wi-Fi, Bluetooth) gereklidir. Yapay zeka destekli √∂zellikler, Gemini API'si kullanƒ±larak metin komutlarƒ±nƒ± robot hareketlerine d√∂n√º≈üt√ºr√ºr.
        </p>
    </div>

    <script>
        const BLYNK_AUTH_TOKEN = "N0zjD19SQgkbPqSTPM40PJjA9JqQAJck"; 
        const GEMINI_API_KEY = "AIzaSyA-BZAMWG3oNvTybh1LY-St6Xoo4KC-E_E"; 

        const VIRTUAL_PIN_MOVEMENT = 'V0';
        const VIRTUAL_PIN_HEADLIGHTS = 'V1';
        const VIRTUAL_PIN_MOTOR_SPEED = 'V2'; // Yeni sanal pin

        const robotStatusElement = document.getElementById('robotStatus');
        const apiMessageElement = document.getElementById('apiMessage');
        const pathInput = document.getElementById('pathInput');
        const forwardBtn = document.getElementById('forwardBtn');
        const backwardBtn = document.getElementById('backwardBtn');
        const leftBtn = document.getElementById('leftBtn');
        const rightBtn = document.getElementById('rightBtn');
        const stopBtn = document.getElementById('stopBtn');
        const planBtn = document.getElementById('planBtn');
        const creativeBtn = document.getElementById('creativeBtn');
        const headlightsBtn = document.getElementById('headlightsBtn');
        const motorSpeedSlider = document.getElementById('motorSpeedSlider');
        const motorSpeedValueDisplay = document.getElementById('motorSpeedValue');

        let isLoading = false; 
        let headlightsOn = false; 
        let movementInterval; 

        function setStatus(status, message = '') {
            robotStatusElement.textContent = status;
            apiMessageElement.textContent = message;
        }

        function setButtonsDisabled(disabled) {
            forwardBtn.disabled = disabled;
            backwardBtn.disabled = disabled;
            leftBtn.disabled = disabled;
            rightBtn.disabled = disabled;
            stopBtn.disabled = disabled;
            planBtn.disabled = disabled;
            creativeBtn.disabled = disabled;
            pathInput.disabled = disabled;
            headlightsBtn.disabled = disabled;
            motorSpeedSlider.disabled = disabled; // Slider'ƒ± da devre dƒ±≈üƒ± bƒ±rak
            isLoading = disabled; 
        }

        async function sendMovementCommand(direction) {
            if (isLoading && direction !== 'Durduruldu') { 
                return;
            }

            setStatus(direction, `Robot komutu g√∂nderiliyor: ${direction}`);
            
            try {
                const response = await fetch(
                    `https://blynk.cloud/external/api/update?token=${BLYNK_AUTH_TOKEN}&${VIRTUAL_PIN_MOVEMENT}=${direction}`,
                    { method: 'GET' }
                );

                if (response.ok) {
                    setStatus(direction, `Komut ba≈üarƒ±yla g√∂nderildi: ${direction}`);
                    console.log(`Blynk'e komut g√∂nderildi: ${direction}`);
                } else {
                    const errorText = await response.text();
                    setStatus(direction, `Komut g√∂nderilemedi: ${response.status} - ${errorText}`);
                    console.error(`Blynk API'ye komut g√∂nderilirken hata: ${response.status} - ${errorText}`);
                }
            } catch (error) {
                setStatus('Hata!', `Aƒü hatasƒ±: ${error.message}. Blynk sunucusuna ula≈üƒ±lamƒ±yor olabilir.`);
                console.error('Aƒü hatasƒ±:', error);
            }
        }

        async function toggleHeadlights() {
            if (isLoading) return;

            setButtonsDisabled(true); 
            const newState = !headlightsOn; 
            setStatus('Farlar', `Farlar ${newState ? 'a√ßƒ±lƒ±yor' : 'kapanƒ±yor'}...`);

            try {
                const response = await fetch(
                    `https://blynk.cloud/external/api/update?token=${BLYNK_AUTH_TOKEN}&${VIRTUAL_PIN_HEADLIGHTS}=${newState ? 1 : 0}`,
                    { method: 'GET' }
                );

                if (response.ok) {
                    headlightsOn = newState; 
                    setStatus('Farlar', `Farlar ba≈üarƒ±yla ${newState ? 'a√ßƒ±ldƒ±' : 'kapandƒ±'}.`);
                    console.log(`Blynk'e far komutu g√∂nderildi: ${newState ? 'A√ßƒ±k' : 'Kapalƒ±'}`);
                } else {
                    const errorText = await response.text();
                    setStatus('Farlar', `Farlar komutu g√∂nderilemedi: ${response.status} - ${errorText}`);
                    console.error(`Blynk API'ye far komutu g√∂nderilirken hata: ${response.status} - ${errorText}`);
                }
            } catch (error) {
                setStatus('Hata!', `Aƒü hatasƒ±: ${error.message}. Blynk sunucusuna ula≈üƒ±lamƒ±yor olabilir.`);
                console.error('Aƒü hatasƒ±:', error);
            } finally {
                setButtonsDisabled(false); 
            }
        }

        // Yeni: Motor hƒ±zƒ±nƒ± Blynk'e g√∂nderen fonksiyon
        async function sendMotorSpeed(speedPercentage) {
            setStatus('Hƒ±z Ayarƒ±', `Motor g√ºc√º ayarlanƒ±yor: ${speedPercentage}%`);
            try {
                const response = await fetch(
                    `https://blynk.cloud/external/api/update?token=${BLYNK_AUTH_TOKEN}&${VIRTUAL_PIN_MOTOR_SPEED}=${speedPercentage}`,
                    { method: 'GET' }
                );
                if (response.ok) {
                    setStatus('Hƒ±z Ayarƒ±', `Motor g√ºc√º ba≈üarƒ±yla ayarlandƒ±: ${speedPercentage}%`);
                    console.log(`Blynk'e motor g√ºc√º g√∂nderildi: ${speedPercentage}%`);
                } else {
                    const errorText = await response.text();
                    setStatus('Hƒ±z Ayarƒ±', `Motor g√ºc√º g√∂nderilemedi: ${response.status} - ${errorText}`);
                    console.error(`Blynk API'ye motor g√ºc√º g√∂nderilirken hata: ${response.status} - ${errorText}`);
                }
            } catch (error) {
                setStatus('Hata!', `Aƒü hatasƒ±: ${error.message}. Blynk sunucusuna ula≈üƒ±lamƒ±yor olabilir.`);
                console.error('Aƒü hatasƒ±:', error);
            }
        }

        // Slider deƒüeri deƒüi≈ütiƒüinde √ßaƒürƒ±lan fonksiyon
        function updateMotorSpeed(value) {
            motorSpeedValueDisplay.textContent = `${value}%`;
            sendMotorSpeed(value);
        }

        function startContinuousMove(direction) {
            if (isLoading) return; 

            if (movementInterval) {
                clearInterval(movementInterval);
            }

            sendMovementCommand(direction); 

            movementInterval = setInterval(() => {
                sendMovementCommand(direction);
            }, 200); 
        }

        function stopContinuousMove() {
            if (isLoading) return; 

            if (movementInterval) {
                clearInterval(movementInterval); 
                movementInterval = null; 
            }
            sendMovementCommand('Durduruldu'); 
        }

        async function executeCommands(commands) {
            setButtonsDisabled(true); 
            for (let i = 0; i < commands.length; i++) {
                const { command, duration_ms } = commands[i];
                setStatus(command, `${command} komutu y√ºr√ºt√ºl√ºyor...`);
                await sendMovementCommand(command); 
                if (command !== 'Durduruldu') { 
                    await new Promise(resolve => setTimeout(resolve, duration_ms || 1000)); 
                }
            }
            await sendMovementCommand('Durduruldu'); 
            setStatus('Durduruldu', 'T√ºm komutlar tamamlandƒ±.');
            setButtonsDisabled(false); 
        }

        async function generatePathPlan() {
            if (!pathInput.value.trim()) {
                setStatus(robotStatusElement.textContent, 'L√ºtfen bir yol tarifi girin.');
                return;
            }

            setButtonsDisabled(true);
            setStatus(robotStatusElement.textContent, 'Yol planƒ± olu≈üturuluyor...');

            try {
                const prompt = `Kullanƒ±cƒ± ≈üu robot hareketini istiyor: "${pathInput.value}". Bu isteƒüi bir dizi komuta d√∂n√º≈üt√ºr. Her komut "ƒ∞leri", "Geri", "Sola D√∂n", "Saƒüa D√∂n" veya "Durduruldu" olmalƒ±. Her komut i√ßin bir 'duration_ms' (milisaniye cinsinden s√ºre) belirt. √ñrneƒüin, "ileri 2 saniye, sonra saƒüa d√∂n 1 saniye, sonra dur". Eƒüer s√ºre belirtilmezse varsayƒ±lan olarak 1000ms kullan. Yanƒ±tƒ± JSON formatƒ±nda ver.`;

                const payload = {
                    contents: [{ role: "user", parts: [{ text: prompt }] }],
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: { 
                            type: "ARRAY",
                            items: {
                                type: "OBJECT",
                                properties: {
                                    "command": { "type": "STRING", "enum": ["ƒ∞leri", "Geri", "Sola D√∂n", "Saƒüa D√∂n", "Durduruldu"] },
                                    "duration_ms": { "type": "INTEGER" }
                                },
                                "required": ["command"]
                            }
                        }
                    }
                };

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const jsonText = result.candidates[0].content.parts[0].text;
                    const parsedCommands = JSON.parse(jsonText); 
                    setStatus(robotStatusElement.textContent, 'Yol planƒ± ba≈üarƒ±yla olu≈üturuldu. Y√ºr√ºt√ºl√ºyor...');
                    await executeCommands(parsedCommands); 
                } else {
                    setStatus(robotStatusElement.textContent, 'Yol planƒ± olu≈üturulamadƒ±. L√ºtfen tekrar deneyin.');
                    console.error('API yanƒ±t yapƒ±sƒ± beklenenden farklƒ±:', result);
                }
            } catch (error) {
                setStatus('Hata!', `API hatasƒ±: ${error.message}`);
                console.error('Yol planƒ± olu≈üturulurken hata olu≈ütu:', error);
            } finally {
                setButtonsDisabled(false);
            }
        }

        async function generateCreativeMovement() {
            setButtonsDisabled(true);
            setStatus(robotStatusElement.textContent, 'Yaratƒ±cƒ± hareket √∂nerisi alƒ±nƒ±yor...');

            try {
                const prompt = `Bir robot i√ßin 3-5 adƒ±mdan olu≈üan kƒ±sa ve yaratƒ±cƒ± bir hareket dizisi olu≈ütur. Her adƒ±m "ƒ∞leri", "Geri", "Sola D√∂n", "Saƒüa D√∂n" veya "Durduruldu" komutlarƒ±ndan biri olmalƒ± ve her komut i√ßin 500ms ile 2000ms arasƒ±nda rastgele bir 'duration_ms' (milisaniye cinsinden s√ºre) belirt. Yanƒ±tƒ± JSON formatƒ±nda ver.`;
                
                const payload = {
                    contents: [{ role: "user", parts: [{ text: prompt }] }],
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: { 
                            type: "ARRAY",
                            items: {
                                type: "OBJECT",
                                properties: {
                                    "command": { "type": "STRING", "enum": ["ƒ∞leri", "Geri", "Sola D√∂n", "Saƒüa D√∂n", "Durduruldu"] },
                                    "duration_ms": { "type": "INTEGER" }
                                },
                                "required": ["command", "duration_ms"]
                            }
                        }
                    }
                };

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const jsonText = result.candidates[0].content.parts[0].text;
                    const parsedCommands = JSON.parse(jsonText);
                    setStatus(robotStatusElement.textContent, 'Yaratƒ±cƒ± hareket √∂nerisi alƒ±ndƒ±. Y√ºr√ºt√ºl√ºyor...');
                    await executeCommands(parsedCommands);
                } else {
                    setStatus(robotStatusElement.textContent, 'Yaratƒ±cƒ± hareket √∂nerisi olu≈üturulamadƒ±. L√ºtfen tekrar deneyin.');
                    console.error('API yanƒ±t yapƒ±sƒ± beklenenden farklƒ±:', result);
                }
            } catch (error) {
                setStatus('Hata!', `API hatasƒ±: ${error.message}`);
                console.error('Yaratƒ±cƒ± hareket olu≈üturulurken hata olu≈ütu:', error);
            } finally {
                setButtonsDisabled(false);
            }
        }

        // Sayfa y√ºklendiƒüinde motor hƒ±zƒ±nƒ± varsayƒ±lan olarak g√∂nder
        window.onload = () => {
            updateMotorSpeed(motorSpeedSlider.value); // Ba≈ülangƒ±√ß deƒüerini g√∂nder
        };
    </script>
</body>
</html>
